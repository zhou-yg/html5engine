<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
		<title>html5 直播  测试站点</title>
	</head>
	<style>
		.switch {
			width: 100px;
			height: 100px;
		}
		video {
			min-width: 320px;
			width: 100%;
			min-height: 320px;
			height: 100%;
		}
		p{
			margin:0;
		}
	</style>
	<body>
		id输入:
		<input id='userId' type="number" value="8089809" />
		<br />
		<button id="switch" class="switch">
			播放id
		</button>
		<button id="switch2" class="switch">
			播放mp4
		</button>
		<button id="switch3" class="switch">
			重置刷新
		</button>
		<button id="switch4" class="switch">
			查看nwState
		</button>
		<button id="switch5" class="switch">
			换一个
		</button>
		<hr />
		<div id="eventsWindow">
			<p>networkstate:<span id="nw"></span></p>
			<p>duration:<span id="dr"></span></p>
		</div>
		<hr />
		<video id="video" controls="true" ></video>
	</body>
	<script type="text/javascript" src="jquery2x.js"></script>
	<script type="text/javascript" src="HLive.js"></script>
	<script type="text/javascript">
		var v;
		var vObj = new HLive('video');
		var ii = 0;
		var canplayI = 0;

		var idArr = [47953200,
14691922,
48608496,
48085827,
42634799,
53998072,
49524479,
48479708,
49525350,
45941960,
54228887,
52296480,
29314740,
51652108,
48652662,
56524360,
59335497,
56966557,
59515783,
49860332,
39888620,
11389934,
54649461,
19424478,
53932715,
35744730,
49525459,
1990458,
55555112,
39516294,
55968145,
10028,
10007 ];

		
		$(document).ready(function() {
			v = $("video")[0];

			var hlsUrl = 'http://pull.kktv8.com/livekktv/44042884/playlist.m3u8';
			var hlsUrl2 = 'http://pull.kktv8.com/livekktv/48277128/playlist.m3u8';
			var nw = ['NETWORK_EMPTY','NETWORK_IDLE','NETWORK_LOADING','NETWORK_NO_SOURCE[1]'];
			var charInt = 97;
			var events = ['abort',
						'canplay',
						'canplaythrough',
						'durationchange',
						'emptied',
						'ended',
						'error',
						'loadeddata',
						'loadedmetadata',
						'loadstart',
						'mozaudioavailable',
						'pause',
						'play',
						'playing',
						'progress',
						'ratechange',
						'seeked',
						'seeking',
						'stalled',
						'suspend',
						'timeupdate',
						'volumchange',
						'waiting'];
			var idI = 0;

			vObj.init({
				poster:'../imgs/animate.png'
			});
			vObj.setEvents({
				progress:function(_e){
					if(_e.load){
						$('#a').text('loading');
					}
					if(_e.buffer){
						$('#a').text('buffering');
					}
				},
				play:function(_e){
					$('#b').text(_e.text);
				},
				error:function(_e){
					$('#c').text(_e.text).css('color','red');
				}
			});


			function createUrl(_v) {
				if (_v) {
					return 'http://pull.kktv8.com/livekktv/' + _v + '/playlist.m3u8';
				}
				return false;
			}
			function resetAll(){
				ii=0;
				
				for(var i=0;i<events.length;i++){
					$('#index_'+String.fromCharCode(charInt+i)).text(' ');
					$('#'+String.fromCharCode(charInt+i)).text(' ');
				}
			}
			$('#switch').click(function() {
				var u = createUrl($('#userId').val());
				if (u) {
					hlsUrl = u;
				}
				v.src = hlsUrl;
				v.load();

			});
			$('#switch2').click(function() {
				v.src = 'Let_it_go.mp4';
			});
			$('#switch3').click(function() {
				v.load();
			});
			$('#switch4').click(function() {
				$('#nw').text(nw[v.networkState]);
			});
			$('#switch5').click(function(){
				
				resetAll();
				
				var rid = idArr[idI++];
				var u   = createUrl(rid);
				
				vObj.playUrl(u);
			});
			
			for(var i=0;i<events.length;i++){
				$('#eventsWindow').append($('<p>'+String.fromCharCode(charInt+i)+'-'+/*events[i]+*/': <span id='+'index_'+String.fromCharCode(charInt+i)+' ></span><span id='+String.fromCharCode(charInt+i)+'><span></p>'));
			}
			/*

			for(var i=0;i<events.length;i++){(
				function(_i){
					v.addEventListener(events[_i],function(_e){
						var $o  = $('#nw').text(nw[v.networkState]);
						var $o1 = $('#index_'+String.fromCharCode(charInt+_i)).text((ii++) + '-');
						var $o2 = $('#'+String.fromCharCode(charInt+_i)).append('|').css('color','#FF0000');
						
						if(events[_i]=='canplay'){
							v.play();
							$o2.css('color','#00FF00');
						}
						if(events[_i]=='durationchange'){
							$('#dr').text(v.duration);
						}
					});
				})(i);
			}
			*/
		});

	</script>
</html>
