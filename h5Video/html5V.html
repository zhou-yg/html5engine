<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
		<title>html5 直播  测试站点</title>
	</head>
	<style>
		.switch {
			width: 100px;
			height: 100px;
		}
		video {
			min-width: 320px;
			width: 100%;
			min-height: 320px;
			height: 100%;
		}
		p{
			margin:0;
		}
	</style>
	<body>
		id输入:
		<input id='userId' type="number" value="46392512" />
		<br />
		<button id="switch" class="switch">
			播放id
		</button>
		<button id="switch2" class="switch">
			播放mp4
		</button>
		<button id="switch3" class="switch">
			重置刷新
		</button>
		<button id="switch4" class="switch">
			查看nwState
		</button>
		<button id="switch5" class="switch">
			换一个
		</button>
		<hr />
		<div id="eventsWindow">
			<p>networkstate:<span id="nw"></span></p>
			<p>duration:<span id="dr"></span></p>
		</div>
		<hr />
		<video controls="true" ></video>
	</body>
	<script type="text/javascript" src="jquery2x.js"></script>
	<script type="text/javascript">
		var v;
		var ii = 0;
		var canplayI = 0;

		var idArr = [35945758,
19882823,
53715807,
48277128,
54552592,
48479708,
42621655,
56395390,
58830131,
21296496,
6981904,
49123503,
55555112,
48608496,
19446376,
54395910,
57617680,
35550298,
22009414,
51283711,
33161602,
44042884,
48652662,
55760698,
53998072,
60033853,
51652108,
21398713,
2408452,
58607284,
56524360,
27168572,
18396560,
49860332,
21912197,
17090754,
52639104,
51578995,
45941960,
10035,
35997038,
34732598,
18152446];

		
		$(document).ready(function() {
			v = $("video")[0];
			v.setAttribute('poster',"../imgs/animate.png");

			var hlsUrl = 'http://pull.kktv8.com/livekktv/44042884/playlist.m3u8';
			var hlsUrl2 = 'http://pull.kktv8.com/livekktv/48277128/playlist.m3u8';
			var nw = ['NETWORK_EMPTY','NETWORK_IDLE','NETWORK_LOADING','NETWORK_NO_SOURCE[1]'];
			var charInt = 97;
			var events = ['abort',
						'canplay',
						'canplaythrough',
						'durationchange',
						'emptied',
						'ended',
						'error',
						'loadeddata',
						'loadedmetadata',
						'loadstart',
						'mozaudioavailable',
						'pause',
						'play',
						'playing',
						'progress',
						'ratechange',
						'seeked',
						'seeking',
						'stalled',
						'suspend',
						'timeupdate',
						'volumchange',
						'waiting'];
			var idI = 0;

			function createUrl(_v) {
				if (_v) {
					return 'http://pull.kktv8.com/livekktv/' + _v + '/playlist.m3u8';
				}
				return false;
			}
			function resetAll(){
				ii=0;
				
				for(var i=0;i<events.length;i++){
					$('#index_'+String.fromCharCode(charInt+i)).text(' ');
					$('#'+String.fromCharCode(charInt+i)).text(' ');
				}
			}
			$('#switch').click(function() {
				var u = createUrl($('#userId').val());
				if (u) {
					hlsUrl = u;
				}
				v.src = hlsUrl;
				v.load();
			});
			$('#switch2').click(function() {
				v.src = '../media/Let_it_go.mp4';
			});
			$('#switch3').click(function() {
				v.load();
			});
			$('#switch4').click(function() {
				$('#nw').text(nw[v.networkState]);
			});
			$('#switch5').click(function(){
				
				resetAll();
				
				var rid = idArr[idI++];
				var u   = createUrl(rid);
				console.log(u);
				v.src = u;
				v.load();
			});
			
			for(var i=0;i<events.length;i++){
				$('#eventsWindow').append($('<p>'+String.fromCharCode(charInt+i)+'-'+events[i]+': <span id='+'index_'+String.fromCharCode(charInt+i)+' ></span><span id='+String.fromCharCode(charInt+i)+'><span></p>'));
			}
			for(var i=0;i<events.length;i++){(
				function(_i){
					v.addEventListener(events[_i],function(_e){
						var $o  = $('#nw').text(nw[v.networkState]);
						var $o1 = $('#index_'+String.fromCharCode(charInt+_i)).text((ii++) + '-');
						var $o2 = $('#'+String.fromCharCode(charInt+_i)).append('|').css('color','#FF0000');
						
						if(events[_i]=='canplaythrough'){
							v.play();
							$o2.css('color','#00FF00');
						}
						if(events[_i]=='durationchange'){
							$('#dr').text(v.duration);
						}
					});
				})(i);
			}
		});
		/*
			function setE() {

				v.addEventListener('canplay', function() {
					$('#a').text('can play now !! ' + canplayI + ' ' + ii++);
					
					canplayI++;
					
					v.play();
				});
				v.addEventListener('playing', function() {
					$('#b').text('playing...! ' + ii++);
				});

				v.addEventListener('timeupdate', function() {
					$('#c').text(v.currentTime );
				});

				v.addEventListener('error', function() {
					alert('error');
				});
				v.addEventListener('loadeddata', function() {
					$('#d').text('data load start ' + ii++);
				});
				//设置url后  -> load() ->play() 会触发
				//load() ->play() 会触发
				v.addEventListener('emptied', function() {
					$('#e').text('become empty ' + ii++);
				});
				v.addEventListener('progress', function() {
					$('#f').text('on progress ' + ii++);
				});
				v.addEventListener('pause', function() {
					$('#g').text('pause ' + ii++);
				});
				v.addEventListener('play', function() {
					$('#h').text('play from pasue ' + ii++);
				});
				//设置url后  -> load() ->play() 不会触发
				//load() ->play() 会触发
				v.addEventListener('abort',function(){
					$('#i').text('aborted ' + ii++);
				});
			}

		 html5 video 摄像头直播，仅限PC
		 navigator.getUserMedia = (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia);
		 if (navigator.getUserMedia) {
		 function success(stream) {
		 v.src = URL.createObjectURL(stream);
		 }
		 function error(e) {
		 console.log(e);
		 }
		 var u = navigator.getUserMedia({video:true},success,error);
		 } else {
		 alert("false");
		 }
		 */

	</script>
</html>
